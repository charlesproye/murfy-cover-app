# Autogenerated from k8s/_templates/kc-oem-iceberg.tpl.yaml by ./scripts/generate-oem-connectors.sh
apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnector
metadata:
  name: oem-iceberg-sink-volkswagen
  namespace: kafka
  labels:
    strimzi.io/cluster: connect-cluster
spec:
  class: org.apache.iceberg.connect.IcebergSinkConnector
  tasksMax: 1
  config:
    topics: oem_push_data_volkswagen

    # Iceberg catalog configuration - Apache Polaris
    iceberg.catalog.type: rest
    iceberg.catalog.uri: http://polaris.polaris.svc.cluster.local:8181/api/catalog
    iceberg.catalog.warehouse: ingestion
    iceberg.catalog.credential: "${secrets:polaris/polaris-user-creds:clientId}:${secrets:polaris/polaris-user-creds:clientSecret}"
    iceberg.catalog.scope: PRINCIPAL_ROLE:ALL

    # S3 file I/O configuration (passed through REST catalog)
    iceberg.catalog.io-impl: org.apache.iceberg.aws.s3.S3FileIO
    iceberg.catalog.s3.endpoint: https://s3.fr-par.scw.cloud
    iceberg.catalog.s3.access-key-id: "${secrets:polaris/polaris-s3-credentials:awsAccessKeyId}"
    iceberg.catalog.s3.secret-access-key: "${secrets:polaris/polaris-s3-credentials:awsSecretAccessKey}"
    iceberg.catalog.client.region: "fr-par"

    # Table configuration
    iceberg.tables: volkswagen.raw_data
    iceberg.tables.auto-create-enabled: false
    iceberg.tables.evolve-schema-enabled: false

    # Control configuration
    iceberg.control.commit.interval-ms: 3600000
    iceberg.control.commit.timeout-ms: 60000

    # Converter configuration
    key.converter: org.apache.kafka.connect.storage.StringConverter
    value.converter: org.apache.kafka.connect.json.JsonConverter
    value.converter.schemas.enable: "false"
