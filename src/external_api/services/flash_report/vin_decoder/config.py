VIN_DICTIONARY = {
    "first_to_third": {
        "5YJ": "USA 3/S",
        "7G2": "USA SEMI",
        "7SA": "USA X/Y",
        "SFZ": "UK ROADSTER",
        "LRW": "CHINA",
        "XP7": "GERMANY",
    },
    "fourth": {
        "3": "Tesla Model 3",
        "Y": "Tesla Model Y",
        "S": "Tesla Modèle S",
        "X": "Tesla Modèle X",
        "R": "Tesla Roadster",
        "T": "Tesla Semi",
        "C": "Tesla Cybertruck",
    },
    "fifth": {
        "A": "5 portes, conduite à gauche, Hayon (Model S) / Berline (Model 3)",
        "B": "5 portes, conduite à droite, hayon (Model S) / Berline (Model 3) / Cabine (Semi)",
        "C": "5 portes, conduite à gauche, SUV",
        "D": "5 portes, conduite à droite, SUV",
        "E": "Conduite à gauche, 4 portes, Berline (Model 3) / 3 portes, Cabriolet (Roadster)",
        "G": "5 portes, conduite à gauche, SUV-Crossover",
        "H": "5 portes, conduite à droite, SUV-Crossover",
    },
    "sixth": {
        "1": "Ceintures de sécurité (2 à l'avant, 3 à l'arrière), airbags frontaux, airbags genoux (à l'avant), airbags latéraux, PODS",
        "3": "Ceintures de sécurité (2 à l'avant, 2 à l'arrière), airbags frontaux, airbags genoux (à l'avant), airbags latéraux",
        "4": "Ceintures de sécurité (2 à l'avant, 2 à l'arrière), airbags frontaux, airbags genoux (à l'avant), airbags latéraux",
        "5": "Ceintures de sécurité (2 avant, 2 arrière), airbags frontaux, airbags latéraux",
        "6": "Ceintures de sécurité (2 avant, 3 arrière), airbags frontaux, airbags latéraux",
        "7": "Ceintures de sécurité (2 avant, 3 arrière), airbags frontaux, airbags latéraux, capot actif",
        "8": "Ceintures de sécurité (2 avant, 2 arrière), airbags frontaux, airbags latéraux, capot actif",
        "A": "Ceintures de sécurité (2 à l'avant, 3 en deuxième rangée, 2 en troisième rangée), airbags frontaux, airbags genoux (à l'avant), airbags latéraux, PODS",
        "B": "Ceintures de sécurité (2 avant, 2 deuxième rangée, 2 troisième rangée), airbags frontaux, airbags genoux (avant), airbags latéraux, PODS",
        "C": "Ceintures de sécurité (2 avant, 2 deuxième rangée, 2 troisième rangée), airbags frontaux, airbags latéraux, PODS",
        "D": "Ceintures de sécurité (2 avant, 3 arrière), airbags frontaux, airbags genoux (avant), airbags latéraux, PODS",
    },
    "seventh": {
        "A": "Chargeur avec puissance de charge de 10 kW",
        "B": "Chargeur avec puissance de charge de 20 kW",
        "C": "Chargeur avec puissance de charge de 10 kW et chargeur rapide DC",
        "D": "Chargeur avec puissance de charge de 20 kW et chargeur rapide DC",
        "E": "Batterie NMC/NCA",
        "F": "Batterie LFP",
        "H": "Batterie NMC de grande capacité (85 kWh)",
        "S": "Batterie NMC de capacité standard (60 kWh)",
        "V": "Batterie NMC à très haute capacité (90 kWh)",
    },
    "eighth": {
        "1": "Un moteur à induction standard à courant alternatif, triphasé",
        "2": "Deux moteurs à induction standard à courant alternatif, triphasé",
        "3": "Un moteur à induction à courant alternatif de performance, triphasé",
        "4": "Deux moteurs à induction à courant alternatif de performance, triphasés",
        "5": "Deux moteurs (Facelift Model S/X)",
        "6": "Trois moteurs (Model S/X Plaid)",
        "A": 'Un moteur standard ou performance de type "Wire Windings"',
        "B": 'Deux moteurs standard de type "Wire Windings" (3#DB, Model 3 ou Semi)',
        "C": 'Deux moteurs Performance de type "Wire Windings" avec batterie de 82 kWh',
        "D": 'Un moteur standard ou performance de type "Wire Windings"',
        "E": 'Deux moteurs standard de type "Wire Windings" (Y#DB, Model Y)',
        "F": 'Deux moteurs Performance de type "Wire Windings" (Y#DP)',
        "G": "moteur non spécifié, batterie 51-60 kWh",
        "J": 'Un moteur standard/performance de type "Hairpin Windings"',
        "K": 'Deux moteurs standard de type "Hairpin Windings"',
        "L": 'Deux moteurs Performance de type "Hairpin Windings"',
        "N": "Un moteur standard, batterie 81-90 kWh",
        "P": "Un moteur Performance, batterie 81-90 kWh",
        "R": 'Un moteur standard de type "Wire Windings" (Y#RB, 3#RB)',
        "S": 'Un moteur standard de type "Hairpin Windings" (Y#RB, 3#RB)',
        "T": "Deux moteurs de performance",
    },
    "tenth": {
        "6": 2006,
        "7": 2007,
        "8": 2008,
        "9": 2009,
        "A": 2010,
        "B": 2011,
        "C": 2012,
        "D": 2013,
        "E": 2014,
        "F": 2015,
        "G": 2016,
        "H": 2017,
        "J": 2018,
        "K": 2019,
        "L": 2020,
        "M": 2021,
        "N": 2022,
        "P": 2023,
        "R": 2024,
        "S": 2025,
    },
    "eleventh": {
        "1": "Californie, Menlo Park",
        "3": "Grande-Bretagne, Hethel (Roadster)",
        "A": "Texas, Austin",
        "B": "Allemagne, Berlin/Grünheide",
        "C": "Chine, Shanghai",
        "F": "Californie, Fremont",
        "G": "Allemagne, Berlin/Grünheide",
        "N": "Nevada, Reno",
        "P": "Californie, Palo Alto",
        "R": "Développement / Recherche",
    },
    "twelfth": {
        "A": "Prototype Stade Alpha",
        "B": "Prototype Stade Bêta",
        "E": "Prototype d'évaluation (Roadster)",
        "F": "Série Founder (Roadster numéro 1 à 1000)",
        "M": "Prototype roulant (Roadster)",
        "P": "Véhicule de production (seulement les 100 000 premières Model S)",
        "R": "Candidat à la sortie",
        "S": "Série Signature (premiers 1000 Model S/X)",
        "V": "Prototype de validation (Roadster)",
    },
}

QUERY = """
    WITH vin_parts AS (
        SELECT
            v.vin,
            CAST(b.net_capacity AS VARCHAR) AS net_capacity,
            LEFT(v.vin, 11) AS discriminative_vin,
            LEFT(v.vin, 3) as factory,
            RIGHT(LEFT(v.vin, 4), 1) AS model,
            RIGHT(LEFT(v.vin, 5), 1) AS carrosserie_volant,
            RIGHT(LEFT(v.vin, 6), 1) AS securite,
            RIGHT(LEFT(v.vin, 7), 1) AS propulsion,
            RIGHT(LEFT(v.vin, 8), 1) AS motorisation,
            RIGHT(LEFT(v.vin, 9), 1) AS ctrl,
            RIGHT(LEFT(v.vin, 10), 1) AS year,
            RIGHT(LEFT(v.vin, 11), 1) AS loc_factory,
            vm.model_name ,
            vm.type,
            vm.version,
            vm.type || '|' || vm.version || '|' || b.net_capacity AS type_version_capa
        FROM vehicle v
        LEFT JOIN vehicle_model vm
            ON v.vehicle_model_id = vm.id
        LEFT JOIN oem o
            ON o.id = vm.oem_id
        LEFT JOIN battery b
            ON b.id = vm.battery_id
        WHERE o.oem_name = 'tesla'
        AND vm.type != 'unknown'
    )
    SELECT
        discriminative_vin,
        STRING_AGG(DISTINCT type, ', ' ORDER BY type) AS type,
        STRING_AGG(DISTINCT version, ', ' ORDER BY version) AS version,
        STRING_AGG(distinct type_version_capa, ';') as type_version_capa,
        STRING_AGG(DISTINCT net_capacity, ', ') AS net_capacities
    FROM vin_parts
    GROUP BY 1;
"""

QUERY_PARTIAL = """
    WITH vin_parts AS (
        SELECT
            v.vin,
            CAST(b.net_capacity AS VARCHAR) AS net_capacity,
            CONCAT(right(LEFT(v.vin, 5), 2), right(LEFT(v.vin, 10), 4)) AS discriminative_vin,
            LEFT(v.vin, 3) as factory,
            RIGHT(LEFT(v.vin, 4), 1) AS model,
            RIGHT(LEFT(v.vin, 5), 1) AS carrosserie_volant,
            RIGHT(LEFT(v.vin, 6), 1) AS securite,
            RIGHT(LEFT(v.vin, 7), 1) AS propulsion,
            RIGHT(LEFT(v.vin, 8), 1) AS motorisation,
            RIGHT(LEFT(v.vin, 9), 1) AS ctrl,
            RIGHT(LEFT(v.vin, 10), 1) AS year,
            RIGHT(LEFT(v.vin, 11), 1) AS loc_factory,
            vm.model_name ,
            vm.type,
            vm.version,
            vm.type || '|' || vm.version || '|' || b.net_capacity AS type_version_capa
        FROM vehicle v
        LEFT JOIN vehicle_model vm
            ON v.vehicle_model_id = vm.id
        LEFT JOIN oem o
            ON o.id = vm.oem_id
        LEFT JOIN battery b
            ON b.id = vm.battery_id
        WHERE o.oem_name = 'tesla'
        AND vm.type != 'unknown'
    )
    SELECT
        discriminative_vin,
        STRING_AGG(DISTINCT type, ', ' ORDER BY type) AS type,
        STRING_AGG(DISTINCT version, ', ' ORDER BY version) AS version,
        STRING_AGG(distinct type_version_capa, ';') as type_version_capa,
        STRING_AGG(DISTINCT net_capacity, ', ') AS net_capacities
    FROM vin_parts
    GROUP BY 1;
"""

