import requests
import json
import os
import time

# ACCESS_TOKEN_OLINO =  ['XP7YGCFS9RB295881', 'LRW3E7FS2RC016306', 'LRW3E7FS5RC039983', 'LRW3E7FS7RC069258', 'LRW3E7FSXRC069268', 'XP7YGCERXRB476714', 'XP7YGCER3RB481589', 'XP7YGCES6RB296469', 'LRW3E7FS7RC039452']
# ACCESS_TOKEN_AYVENS_SLBV = ['5YJ3E7EA4LF551207', '5YJ3E7EA4KF373524', '5YJXCCE26LF223957', '5YJ3E7EA0KF525590', '5YJ3E7EA4KF531649']
# ACCESS_TOKEN_AYVENS_BLBV = ['5YJ3E7EA2KF380715', '5YJ3E7EA5KF531322', '5YJ3E7EA3LF552039', '5YJ3E7EA4LF552812', '5YJ3E7EA3LF558763', '5YJ3E7EA5LF553158', '5YJ3E7EA1LF552654', 'LRW3E7FA8LC098010', '5YJ3E7EA6KF531331', '5YJ3E7EA4LF541079', '5YJ3E7EA6KF370186', 'LRW3E7FA1LC103127', 'LRW3E7FA3LC103260', '5YJ3E7EA9LF551994', '5YJ3E7EA5LF552074', 'LRW3E7FA4LC103123']
# ACCESS_TOKEN_AYVENS = ['LRW3E7EK8MC346834', '5YJ3E7EBXMF837489', '5YJ3E7ECXMF829854', '5YJSA7E47MF419819', '5YJ3E7EB9MF817265', 'LRW3E7EKXMC347189', '5YJSA7E2XKF304823', '5YJ3E7EB9MF815533', '5YJ3E7EC8MF830078', 'LRW3E7EK8MC385441', 'LRW3E7FA0MC351306', 'LRW3E7EB9MC424487', '5YJ3E7EB6LF674127', 'LRW3E7FJ1MC332828', '5YJ3E7EB4MF834541', 'LRW3E7EK4MC324023', '5YJ3E7EB6MF831754', '5YJ3E7EC2MF843571', '5YJ3E7EBXMF817341', 'LRW3E7EK6MC385177', '5YJ3E7EB9MF817086', 'LRW3E7EK9MC343229', 'LRW3E7EK6MC345472', 'LRW3E7EK4MC384478', '5YJ3E7EC8MF830016', 'LRW3E7EB2MC419681', 'LRW3E7EC2MC428003', '5YJ3E7EB8MF819119', '5YJ3E7EB1LF765211', 'LRWYGCEK2MC065136', 'LRW3E7EK4MC345308', 'LRWYGCEK4MC129970', '5YJ3E7EB0MF820099', '5YJ3E7EB4LF780334', '5YJ3E7EB4MF826343', '5YJ3E7EB4MF833700', '5YJ3E7EB5MF818526', '5YJ3E7EB0LF758055', '5YJ3E7EB3MF818797', 'LRW3E7EB3MC434867', 'LRW3E7EK7MC383602', 'LRW3E7FJXMC332939', 'LRW3E7FA6MC426526', '5YJ3E7EBXMF837136', 'LRW3E7EC1MC426811', 'LRW3E7EB8MC424478', 'LRW3E7FA0MC350835', 'LRW3E7EK5MC401112', 'LRW3E7EK5MC343311', 'LRW3E7EC4MC342854', 'XP7YGCELXPB052250', 'LRW3E7EK0MC400028', 'LRW3E7EC8MC425459']
# ACCESS_TOKEN_AYVENS_NV = ['5YJ3E7EA9KF516435', '5YJ3E7EAXKF522731', '5YJ3E7EA7KF467008', '5YJ3E7EA1KF375070', '5YJ3E7EA5KF489525', '5YJ3E7EA3LF552056', '5YJ3E7EA2LF553196', '5YJ3E7EA5LF723230', '5YJ3E7EA5KF470232', '5YJ3E7EA4LF536030', '5YJ3E7EA7KF531483', '5YJ3E7EA5LF541477', '5YJ3E7EAXLF553138', '5YJ3E7EA3LF557550', '5YJ3E7EA8KF500680', '5YJ3E7EA6LF536174', '5YJ3E7EA1KF536002', '5YJ3E7EA2KF379743', '5YJ3E7EA6KF522743', '5YJ3E7EA7LF779167', 'LRW3E7FA4LC097954', '5YJ3E7EA0KF516369', '5YJ3E7EA6LF767267', '5YJ3E7EA7LF782747', 'LRW3E7FA8LC106042', '5YJ3E7EAXLF761245', 'LRW3E7FAXLC103983', 'LRW3E7FAXLC100047', 'LRW3E7FA3LC099789', '5YJ3E7EA7LF779511', '5YJ3E7EA5KF489511', '5YJSA7E28MF418841', 'LRW3E7FA3LC103128', 'LRW3E7FA3LC101606', 'LRW3E7FA2LC104092', '5YJ3E7EA8KF379763', '5YJ3E7EA3KF525566', '5YJ3E7EA2KF522724', '5YJ3E7EA4KF470304', '5YJ3E7EA2LF588711', '5YJ3E7EA0KF489402', '5YJ3E7EA6LF541195', '5YJ3E7EAXLF553141', '5YJXCCE27LF219657', '5YJ3E7EAXKF499709', '5YJ3E7EA3LF552882', '5YJ3E7EA7LF536149', '5YJ3E7EA3LF526279', '5YJ3E7EA7LF552836', '5YJSA7E22LF355329', '5YJ3E7EA6LF531413', '5YJ3E7EA8KF489230', '5YJ3E7EA3KF470410', '5YJSA7E29KF337263', '5YJ3E7EAXLF551230', 'LRW3E7FA8LC103478', '5YJSA7E23KF341132', '5YJ3E7EA4KF531456', 'LRW3E7FA6LC103124', '5YJSA7E29LF408768', '5YJ3E7EA0LF531102', '5YJ3E7EA5LF547392', 'LRW3E7FA0LC099670', 'LRW3E7FA8LC103190', 'LRW3E7FA5LC103115', '5YJ3E7EAXLF759155', '5YJXCCE21JF123908', '5YJXCCE22MF318811', 'LRW3E7FA1LC103340', '5YJSA7E25JF267825', '5YJ3E7EA4LF671010', '5YJSA7E29MF419772', '5YJXCCE22LF222966', '5YJ3E7EA7LF553114', '5YJXCCE26KF215694', 'LRW3E7FA9LC103182', '5YJ3E7EA8LF553042', '5YJ3E7EA1KF516638', '5YJ3E7EA1LF557918', 'LRW3E7FAXLC099773', '5YJ3E7EA3KF531528', '5YJ3E7EA3KF374972', '5YJ3E7EAXKF525726', '5YJ3E7EA7LF547751', '5YJ3E7EA6KF474306', '5YJ3E7EA4KF531490', '5YJSA7E29LF355473', '5YJ3E7EA0KF531499', '5YJ3E7EA6LF654600', '5YJSA7E28KF334600', '5YJ3E7EA8KF474307', '5YJ3E7EAXLF531365', '5YJ3E7EA4KF525544', '5YJ3E7EA6LF558840', '5YJ3E7EA2KF531343', '5YJ3E7EA4LF551854', '5YJ3E7EA1LF516544', '5YJ3E7EA1LF541265', '5YJ3E7EA7LF553159', '5YJ3E7EA6KF373492', '5YJ3E7EA1LF536048', '5YJ3E7EA1LF547891', '5YJ3E7EA8LF755489', '5YJ3E7EA5LF516255', 'LRW3E7FA6LC104094', 'LRW3E7FA9LC101612', '5YJ3E7EA7LF727876', 'LRW3E7FA4LC099736', 'LRW3E7FA1LC103158', '5YJ3E7EA5LF779278', 'LRW3E7FA0LC103961', 'LRW3E7FA7LC103584', '5YJ3E7EA1LF759058', '5YJ3E7EA6KF500970', 'LRW3E7FA1LC103628', '5YJ3E7EA8KF474310', '5YJ3E7EA4LF541082', '5YJXCCE28LF227072', '5YJ3E7EA6LF516541', '5YJSA7E23LF356554', '5YJ3E7EA4LF547495', '5YJ3E7EA2KF489417', 'LRW3E7FA5LC098336', '5YJ3E7EA0LF551933', '5YJ3E7EA4LF541454', 'LRWYGCEK3MC139857', '5YJ3E7EA3LF552509', '5YJ3E7EA0LF771671', '5YJSA7E29KF337862', '5YJ3E7EA1LF547454', '5YJ3E7EA9LF552398', 'LRW3E7FA7LC103486']
# ACCESS_TOKEN_AYVENS_NVA = ['5YJSA7E22LF404531', 'LRWYGCFS1PC578526', 'LRWYGCFS4PC636919', '5YJ3E7ECXLF581054', '5YJ3E7EC6LF578992', '5YJXCCE2XKF188922', 'LRWYGCFS4PC635026', 'LRWYGCFS9PC635023', '5YJ3E7EB8KF407943', '5YJ3E7EB3KF490164', '5YJ3E7EB7KF469026', '5YJSA7E21LF350090', '5YJSA7E29KF333469', '5YJ3E7EB4KF518280', '5YJ3E7EB8KF480052', '5YJ3E7EB0KF383864', '5YJ3E7EB8KF334931', '5YJSA7E29LF354047', '5YJ3E7EC2LF593909', '5YJ3E7EC4LF581065', '5YJ3E7ECXLF594306', '5YJ3E7EBXLF567145', '5YJ3E7EC5LF593984', '5YJ3E7EC9LF594636', '5YJSA7E26LF358301', '5YJ3E7EC8LF608297', '5YJ3E7EC1LF579919', '5YJ3E7EC9LF594281', '5YJ3E7EC6LF608234', '5YJ3E7EB4LF564533', '5YJ3E7EB6LF565828', '5YJ3E7EC6LF609092', '5YJ3E7EB7LF565868', '5YJ3E7EC9LF608230', '5YJ3E7EB2LF561338', '5YJ3E7EC6LF594237', '5YJ3E7EB8LF564552', '5YJ3E7EB3LF566676', '5YJ3E7EC2LF608389', '5YJXCCE23LF226167', '5YJ3E7ECXLF593947', '5YJ3E7EC7LF581075', '5YJ3E7EBXLF561944', '5YJ3E7EC1LF593898', '5YJ3E7EB0KF532516', '5YJ3E7EB9LF604766', '5YJXCCE28KF189003', '5YJXCCE25KF188438', '5YJ3E7EB0LF564996', '5YJ3E7EC6LF578989', '5YJ3E7EB8LF565488', '5YJ3E7EC4LF605199', '5YJ3E7EB5LF678069', '5YJ3E7EB9LF729508', '5YJ3E7EC7LF594344', '5YJ3E7EB8KF523353', '5YJSA7E2XJF285172', '5YJSA7E24JF282199', '5YJXCCE25MF308340', '5YJSA7E22JF282444', '5YJSA7E21JF271127', '5YJXCCE21MF318394', '5YJ3E7EC5LF782215', '5YJ3E7EC1MF835171', '5YJXCCE25MF311237', '5YJ3E7EB1MF845366', '5YJ3E7EC5MF838879', '5YJ3E7EB6KF490353', '5YJ3E7EC1LF578642', '5YJ3E7EC0LF593908', '5YJ3E7EC5LF581155', '5YJ3E7EC0LF594329', '5YJ3E7EB2KF520271', '5YJ3E7EB5LF604862', '5YJ3E7EB3LF629534', '5YJ3E7EB9LF567136', '5YJ3E7EB3LF567147', '5YJ3E7EC7LF594103', '5YJ3E7EB8LF589516', '5YJ3E7EC7LF594151', '5YJ3E7EC3LF608188', '5YJ3E7EC4LF580711', '5YJ3E7EB6LF565750', '5YJ3E7EC4LF593913', '5YJ3E7EB4LF570123', '5YJ3E7EC7LF610719', '5YJ3E7EC5LF581074', '5YJ3E7EB3LF566614', '5YJ3E7EBXLF570059', '5YJSA7E23LF356179', '5YJ3E7EB6LF564551', '5YJ3E7EC1LF589592', '5YJ3E7EB3LF607405', '5YJ3E7EC4LF594494', '5YJSA7E27LF354094', '5YJ3E7EB3LF589374', '5YJ3E7EC1LF629637', '5YJ3E7EC9LF629613', '5YJ3E7EC5LF581138', '5YJXCCE2XLF231947', '5YJ3E7EC7LF605164', '5YJ3E7EB4LF593689', '5YJ3E7EC0LF594413', '5YJ3E7EB0LF604820', '5YJSA7E27KF349928', '5YJ3E7EC2LF730752', '5YJ3E7EB9LF566617', '5YJSA7E28JF288328', '5YJSA7E28JF268533', '5YJSA7E21JF284993', '5YJ3E7EC8MF835085', '5YJSA7E22MF421704', '5YJ3E7EB9KF334954', '5YJ3E7EB8KF523417', '5YJ3E7EB1LF609816', '5YJ3E7EB2KF339154', '5YJSA7E23KF313797', '5YJ3E7EC9LF593941', '5YJXCCE21LF222652', '5YJ3E7EC3LF580375', '5YJ3E7EC9LF594068', '5YJ3E7EB1LF589406', '5YJ3E7EB0LF589428', '5YJ3E7ECXLF594645', '5YJ3E7EB8LF566611', '5YJ3E7EB6KF490384', '5YJ3E7EC0LF593939', '5YJ3E7EC2LF610806', '5YJ3E7EB8LF610638', '5YJ3E7EB9LF563166', '5YJ3E7EB9LF561658', '5YJ3E7EB1LF593424', '5YJ3E7EB2KF467166', '5YJ3E7EB2LF565647', '5YJ3E7EB9LF589556', '5YJ3E7EB1LF560441', '5YJ3E7EC9LF594054', '5YJXCCE28KF188787', '5YJ3E7EC2LF594588', '5YJ3E7EB3LF607761', '5YJ3E7EB6LF607897', '5YJ3E7EC0LF594007', '5YJ3E7EB5LF566601', '5YJXCCE2XKF217335', '5YJ3E7EB6LF607785', '5YJ3E7EC7LF588656', '5YJ3E7EC7LF580122', '5YJXCCE21JF126484', '5YJ3E7EB7LF766122', '5YJSA7E24JF288374', '5YJSA7E2XMF416797', '5YJSA7E27LF359814', '5YJ3E7EB2MF825613', '5YJ3E7EC6MF844822', '5YJ3E7EB1LF781523', '5YJ3E7EB1LF780663', '5YJSA7E29MF423112', '5YJ3E7EC5LF581124', '5YJ3E7EB7KF469088', '5YJSA7E25KF334876', '5YJ3E7EC9LF594152', '5YJ3E7EC1LF629640', '5YJ3E7EC8LF580372', '5YJ3E7EC0LF593911', '5YJSA7E41LF349555', '5YJSA7E41LF358868', '5YJ3E7EB1LF567177', '5YJ3E7EC9LF587220', '5YJ3E7EC3LF605209', '5YJ3E7EB6LF593435', '5YJ3E7EC3LF581171', '5YJ3E7EC5LF579017', '5YJ3E7EB7LF567197', '5YJ3E7EC5LF581947', '5YJ3E7EB6LF781274', '5YJSA7E29MF422901', '5YJ3E7EBXKF415591', '5YJ3E7EB9KF367856', '5YJ3E7EC5LF605180', '5YJ3E7EC6LF594139', '5YJ3E7EC0LF594069', '5YJ3E7EB4KF490299', '5YJXCCE29KF215558', '5YJ3E7EBXKF523404', '5YJ3E7EC5LF578532', '5YJ3E7EB9LF593834', '5YJXCCE21LF221694', '5YJ3E7EB8KF501076', '5YJ3E7ECXLF594242', '5YJ3E7EC3LF594650', '5YJ3E7EB5KF523214', '5YJSA7E20LF355779', '5YJ3E7EB4LF589433', '5YJ3E7EB1LF607791', '5YJ3E7EB8KF472632', '5YJ3E7EB7LF604927', '5YJ3E7EC8LF578542', '5YJ3E7EC6LF589605', '5YJ3E7EB2LF593500', '5YJ3E7EB1LF593469', '5YJ3E7EB3LF565737', '5YJ3E7ECXLF580101', '5YJ3E7EBXLF564438', '5YJ3E7EB1LF564506', '5YJ3E7EB6LF593175', '5YJ3E7EC7LF594196', '5YJ3E7EB3LF629498', '5YJ3E7EB6LF610637', '5YJ3E7EB7LF589409', '5YJ3E7EC9LF605182', '5YJ3E7EC0LF578485', '5YJ3E7EC4LF581695', '5YJ3E7EC0LF581113', '5YJSA7E24KF344332', '5YJ3E7EC7LF593906', '5YJ3E7ECXLF594385', '5YJ3E7EB1LF679560', '5YJ3E7EC4LF594138', '5YJ3E7EBXLF565170', '5YJSA7E28LF355481', '5YJXCCE29LF223922', '5YJ3E7EC3LF594194', '5YJSA7E2XMF423068', '5YJXCCE26LF294222', '5YJSA7E26JF284469', '5YJ3E7ECXLF782033', '5YJ3E7EC5MF829969', '5YJ3E7EB5KF469025', '5YJ3E7EC2LF605153', '5YJ3E7EB0LF570572', '5YJ3E7EC1LF581136', '5YJ3E7EB7LF593668', '5YJ3E7EC1LF594405', '5YJ3E7EBXLF567176', '5YJ3E7EC7LF594473', '5YJ3E7EB6LF569572', '5YJ3E7EC2LF594235', '5YJ3E7EC3LF578657', '5YJ3E7EB1LF564733', '5YJ3E7EC4LF581048', '5YJ3E7EC5LF593967', '5YJ3E7EBXLF572085', '5YJ3E7EB1LF589468', '5YJ3E7EB1LF564828', '5YJ3E7EBXLF567162', '5YJ3E7EB9LF563183', '5YJ3E7EB1LF567146', '5YJ3E7EB0LF680411', '5YJXCCE23KF183996', '5YJ3E7EB7LF757646', '5YJSA7E28LF405456', '5YJSA7E26JF275075', '5YJ3E7EB9LF567167', '5YJSA7E21JF276411', '5YJSA7E25LF408573', '5YJ3E7EC6MF838051', '5YJ3E7EB0LF589431', '5YJ3E7EB6LF609861', '5YJ3E7EB5LF567151', '5YJ3E7EB4LF604870', '5YJ3E7EC1LF610831', '5YJ3E7EC2LF581131', '5YJ3E7EC1LF594226', '5YJ3E7EB1LF678215', '5YJ3E7EC7LF579018', '5YJ3E7EBXLF748391', '5YJSA7E22JF284307', '5YJSA7E24JF285006', '5YJ3E7EB3LF674621', '5YJ3E7EC1LF681656', 'LRW3E7EC0MC342432', 'LRWYGCFS0PC578825', 'LRWYGCFS2PC578681', 'LRWYGCFS6PC578828', 'LRWYGCEK3PC641398', 'LRWYGCFS3PC579614', 'LRW3E7EC7MC310335', '5YJ3E7EC3LF580327', 'LRW3E7EC8MC326091', 'LRWYGCFS6PC635027', 'LRWYGCFS2PC578826', 'LRWYGCFS9PC579360', 'LRWYGCFS5PC578836', 'LRWYGCFS9PC579357', 'LRWYGCFS1PC578834', 'LRWYGCFS3PC578530', 'LRWYGCFS0PC579361', 'LRWYGCFS5PC578528', 'LRWYGCFS8PC635028', 'LRWYGCFS5PC578674', 'XP7YGCEK6PB137691', '5YJ3E7EA1LF755396']
ACCESS_TOKEN_AYVENS_CAPFM = ['LRW3E7EJ0SC355239', 'XP7YGCERXRB505399']

current_dir = os.path.dirname(os.path.abspath(__file__))
file_path = os.path.join(current_dir, 'options.json')

all_data = []

for token in ACCESS_TOKEN_AYVENS_CAPFM:
    success = False
    retries = 3  # Nombre maximum de tentatives
    
    while not success and retries > 0:
        try:
            url = f"https://fleet-api.prd.eu.vn.cloud.tesla.com/api/1/dx/vehicles/options?vin={token}"
            headers = {'Authorization': f'Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InFEc3NoM2FTV0cyT05YTTdLMzFWV0VVRW5BNCJ9.eyJndHkiOiJjbGllbnQtY3JlZGVudGlhbHMiLCJzdWIiOiI4ZDc0ZjFlMS05NDM3LTQwZmItYjYwYi04ODFjZGVlMmQ2MmYiLCJpc3MiOiJodHRwczovL2F1dGgudGVzbGEuY29tL29hdXRoMi92My9udHMiLCJhenAiOiI4ODMyMjc3YWU0Y2MtNDQ2MS04Mzk2LTEyNzMxMDEyOWRjNiIsImF1ZCI6WyJodHRwczovL2F1dGgudGVzbGEuY29tL29hdXRoMi92My9jbGllbnRpbmZvIiwiaHR0cHM6Ly9mbGVldC1hcGkucHJkLmV1LnZuLmNsb3VkLnRlc2xhLmNvbSJdLCJleHAiOjE3MzE1MzE5NDIsImlhdCI6MTczMTUwMzE0MiwiYWNjb3VudF90eXBlIjoiYnVzaW5lc3MiLCJvcGVuX3NvdXJjZSI6bnVsbCwiYWN0Ijp7InN1YiI6IjJhNmQ0ZDNlLTA0MjktMTFlOS05MDc3LTAwNTA1NjlhOTJlOSIsInNjcCI6WyJ1c2VyX2RhdGEiLCJ2ZWhpY2xlX2RldmljZV9kYXRhIiwidmVoaWNsZV9jbWRzIiwidmVoaWNsZV9jaGFyZ2luZ19jbWRzIiwiZW5lcmd5X2NtZHMiLCJlbmVyZ3lfZGV2aWNlX2RhdGEiXX19.gmzWu400W96wMWM_FTg4NA1mNBr4uOqx6JeqQzkuREpzA_E80K43MRW2soU4ARpPGlCHgUAWwBypq2pdh0wZJe5N7HM4uD4hB3X6QJu6dXX89IThkfInS53oVcL2KR9snzHeR5xrcJdXvhrbFgfKLYlfKThq44s4NEmIEU7JMGEFK-I3hXXS4UpL8olAjirRMZkg13UpT_JSVVbRO1ogTKrn6_hfEE2GqX-ITor1wE283GaNwllxTQoAdYrreLWI-9WK-wy2w9bgNSKVYIay9b_GjKKevjwylbMDHcZcdySBqNwHQdIKBC48soo4PTjUtFpEwMI9YYCyX6kd8GTjiA'}
            response = requests.get(url, headers=headers)
            
            data = {
                'codes': response.json()['codes'],
                'vin': token
            }
        
            all_data.append(data)
            print(f"Added data for VIN: {token}")
            success = True
            
        except Exception as e:
            retries -= 1
            if retries > 0:
                print(f"Error processing VIN {token}, retrying... ({retries} attempts left)")
                time.sleep(1)  # Attendre 1 seconde avant de r√©essayer
            else:
                print(f"Failed to process VIN {token} after all attempts: {str(e)}")

try:
    with open(file_path, 'w') as f:
        json.dump(all_data, f, indent=2)
    print(f"Successfully wrote all data to {file_path}")
except Exception as e:
    print(f"Error writing to file: {str(e)}")
